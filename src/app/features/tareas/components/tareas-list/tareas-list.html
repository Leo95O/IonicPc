<ion-header class="ion-no-border bg-slate-50/80 backdrop-blur-md">
  <ion-toolbar class="bg-transparent">
    <ion-buttons slot="start">
      @if (proyectoId) {
        <ion-back-button defaultHref="/features/proyectos" text="" color="dark"></ion-back-button>
      } @else {
         <ion-menu-button color="dark"></ion-menu-button>
      }
    </ion-buttons>

    <div class="flex flex-col items-start ml-2 py-2">
      <h1 class="text-xl font-extrabold text-slate-900 m-0 p-0 tracking-tight flex items-center gap-2">
        @if(proyectoId) {
            Tablero de Proyecto
        } @else {
            <fa-icon [icon]="icons.tasks" class="text-indigo-500 text-lg opacity-80"></fa-icon>
            Mis Tareas
        }
      </h1>
      <p class="text-xs font-medium text-slate-500 m-0">
        {{ proyectoId ? 'Gestiona los entregables' : 'Organiza tu día a día' }}
      </p>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="bg-slate-50">

  <div class="px-4 pt-2 pb-24">
    <ion-list lines="none" class="bg-transparent space-y-4">

      @for (tarea of tareas$ | async; track tarea.id) {

        @let prioridad = getPrioridadUi(tarea.prioridadId);
        @let estado = getEstadoUi(tarea.estadoId);

        <ion-item-sliding #sliding class="rounded-2xl shadow-[0_4px_20px_-4px_rgba(0,0,0,0.05)] bg-white overflow-hidden group">

          <ion-item class="ion-no-padding !bg-transparent" lines="none" detail="false">
            <div class="w-full p-5 flex flex-col gap-3 relative">
              
              <div [class]="'absolute left-0 top-0 bottom-0 w-1.5 ' + estado.textClass.replace('text', 'bg')"></div>

              <div class="flex justify-between items-center mb-1 pl-2">
                <div class="flex items-center gap-2">
                   <div [class]="'h-8 w-8 rounded-full flex items-center justify-center ' + estado.bgIcon">
                       <fa-icon [icon]="estado.icon" [class]="'text-lg ' + estado.textClass" [fixedWidth]="true"></fa-icon>
                   </div>
                   <span [class]="'text-xs font-bold uppercase tracking-wider ' + estado.textClass">
                     {{ estado.label }}
                   </span>
                </div>

                <div [class]="'px-2.5 py-1 rounded-lg text-xs font-bold flex items-center gap-1.5 ' + prioridad.badgeClass">
                  <fa-icon [icon]="prioridad.icon" [class]="prioridad.iconClass"></fa-icon>
                  {{ prioridad.label }}
                </div>
              </div>

              <div class="pl-2">
                <h2 class="text-[17px] font-bold text-slate-800 leading-snug mb-1.5 group-hover:text-indigo-700 transition-colors">
                  {{ tarea.titulo }}
                </h2>
                <p class="text-sm text-slate-500 line-clamp-2 leading-relaxed font-normal">
                  {{ tarea.descripcion || 'Sin detalles adicionales.' }}
                </p>
              </div>

              <div class="flex items-center justify-between pt-3 border-t border-slate-100 mt-1 pl-2">
                <div class="flex items-center gap-1.5 text-slate-500 text-xs font-medium bg-slate-100 px-2 py-1 rounded-md">
                  <fa-icon [icon]="icons.calendar" class="text-slate-400"></fa-icon>
                  <span>{{ tarea.fechaLimite | date:'d MMM, h:mm a' }}</span>
                </div>

                 @if (tarea.usuarioAsignado) {
                    <div class="flex items-center">
                        <div class="h-7 w-7 rounded-full bg-indigo-100 border-2 border-white flex items-center justify-center shadow-sm">
                            <span class="text-xs font-bold text-indigo-600">UA</span>
                        </div>
                    </div>
                 } @else {
                     <span class="text-xs text-slate-400 italic">Sin asignar</span>
                 }
              </div>
            </div>
          </ion-item>

          <ion-item-options side="end">
            <ion-item-option class="bg-green-50 rounded-l-2xl" (click)="cambiarEstado(tarea.id, 3); sliding.close()">
              <div class="flex flex-col items-center justify-center h-full w-[70px] text-green-600">
                <fa-icon [icon]="icons.check" class="text-xl mb-1"></fa-icon>
                <span class="text-[10px] font-bold uppercase">Hecho</span>
              </div>
            </ion-item-option>
          </ion-item-options>

          <ion-item-options side="start">
            <ion-item-option class="bg-red-50 rounded-r-2xl" (click)="eliminar(tarea.id); sliding.close()">
              <div class="flex flex-col items-center justify-center h-full w-[70px] text-red-600">
                <fa-icon [icon]="icons.trash" class="text-xl mb-1"></fa-icon>
                 <span class="text-[10px] font-bold uppercase">Borrar</span>
              </div>
            </ion-item-option>
          </ion-item-options>

        </ion-item-sliding>

      } @empty {
        <div class="flex flex-col items-center justify-center h-[60vh] px-6 text-center">
          <div class="bg-indigo-50 p-8 rounded-3xl mb-6 shadow-sm relative overflow-hidden">
            <fa-icon [icon]="icons.empty" class="text-7xl text-indigo-400 relative z-10"></fa-icon>
          </div>
          <h3 class="text-2xl font-extrabold text-slate-800 mb-3">Todo limpio</h3>
          <p class="text-slate-500 text-base max-w-xs mx-auto">
            No hay tareas pendientes.
          </p>
        </div>
      }

    </ion-list>
  </div>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed" class="mb-6 mr-4">
    <ion-fab-button class="shadow-2xl shadow-indigo-500/30" color="primary">
      <fa-icon [icon]="icons.add" class="text-xl"></fa-icon>
    </ion-fab-button>
  </ion-fab>

</ion-content>